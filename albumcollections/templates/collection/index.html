{% extends 'base.html' %}

{% block content %}
    <body
    {% if is_user_logged_in() %}
        onload="init('{{collection.id}}', true)"
    {% else %}
        onload="init('{{collection.id}}', false)"
    {% endif %}
    >
        <!-- TODO: Probably should update this guidance or remove it -->
        {% if collection.albums|length == 0 %}
            <div class="main_text">
                <p>
                    You don't have any albums in this collection yet! Add at least one album to the corresponding Spotify playlist then come back here.
                </p>
                <p>
                    For more details check out the <a href="{{url_for('main.about')}}#guide">guide</a>.
                </p>
            </div>
        {% endif %}

        <!-- Collection Albums -->
        <form
            method="post"
            action="{{ url_for('collection.fill_missing_tracks', playlist_id=collection.id)}}";>
            <input class="btn btn-danger btn_main" type="submit" value="Fill in missing tracks">
        </form>
        <div id="collection_list" class="row justify-content-center justify-content-md-start" oncontextmenu="return false;">
            {% for album in collection.albums %}
                <!-- col-5 -->
                <div class="col col-auto col-md-auto album_item
                    '{% if album.complete %}'
                        complete_album
                    '{% else %}'
                        incomplete_album
                    '{% endif %}'
                    "
                    id="{{album.id}}"
                    data-album_id="{{album.id}}"
                    data-album_name="{{album.name}}"
                    data-album_artists="{{album.get_artists_comma_separated()}}"
                    data-album_img_url="{{album.img_url}}"
                    data-album_link="{{album.link}}">
                    <div class="card bg-light album_card" data-toggle="modal" data-target="#album_control_modal">
                        <img
                            '{% if album.img_url %}'
                                src="{{album.img_url}}"
                            '{% else %}'
                                src="/static/images/other/unknown_sp_item.jpg"
                            '{% endif %}'
                            alt="{{album.name}}"
                            class="card-img img-fluid album_img"
                            '{% if collection.albums|length < 15 %}'
                                style="min-width: 100px;"
                            '{% elif collection.albums|length < 30 %}'
                                style="min-width: 75px;"
                            '{% endif %}'
                        >
                        <div class="album-item-move-container d-flex align-items-center justify-content-center">
                            <img class="album-item-move img-fluid" src="/static/images/bootstrap/arrows-move.svg" style="width: 30px; display: none;"/>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>

        <!-- Collection control navbar -->
        <div class="bg-light py-2 d-flex fixed-bottom">
            <div class="scroll-to-fit-title me-auto mx-2 text-blue-theme"><span class="fs-4">{{collection.name}}</span></div>

            <button id="play_collection" class="btn btn-outline-success mx-2">
                <img src="/static/images/bootstrap/play.svg"/>
            </button>

            <button id="shuffle_play_collection" class="btn btn-outline-success mx-2">
                <img src="/static/images/bootstrap/shuffle.svg"/><img src="/static/images/bootstrap/play.svg"/>
            </button>

            <div id="reorder_collection">
                <input type="checkbox" class="btn-check" id="reorder-active" autocomplete="off">
                <label class="btn btn-outline-primary mx-2" for="reorder-active">
                    <img src="/static/images/bootstrap/arrows-move.svg"/>
                </label>
            </div>

            <a class="btn btn-outline-secondary mx-2" role="button" href="{{collection.link}}">
                <img src="/static/images/spotify/Spotify_Icon_RGB_Black.png" class="spotify_icon_small_img"/>
            </a>
        </div>

    <!-- Select device popup window-->
    <div id="select_device_modal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Select device to play collection</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <select id="device_select" class="form-select form-select-lg mb-3" aria-label=".form-select-lg example">
                    </select>
                    <div id="device_play_loader" class="d-flex flex-column align-items-center">
                        <div class="device_play_load_item loader py-2" style="display: none;"></div>
                        <div class="device_play_load_item py-2" style="display: none;"><p>Dropping the needle...</p></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="play_on_selected_device" class="btn btn-primary"><img src="/static/images/bootstrap/play.svg"/></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Album control popup window-->
    <div id="album_control_modal" class="modal fade" role="dialog" data-target_album_item_id="">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex justify-content-center">
                        <img
                            class="img-fluid"
                            id="album_control_modal_img"
                        >
                    </div>
                    <div class="scroll-to-fit-title mt-2">
                        <span id="album_control_modal_title"></span>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="play_collection_from_album" class="album_control_bar btn btn-outline-success mx-2"><img src="/static/images/bootstrap/play.svg"/></button>
                    <a class="album_control_bar btn btn-outline-secondary" role="button" id="album_control_modal_spotify_link">
                        <img src="/static/images/spotify/Spotify_Icon_RGB_Black.png" class="spotify_icon_small_img"/>
                    </a>
                    <button id="album_control_modal_remove" type="button" class="album_control_bar btn btn-danger ms-auto"><img src="/static/images/bootstrap/trash.svg"/></button>
                </div>
                <div class="d-flex flex-column align-items-center">
                    <div class="remove_album_load_item loader py-2" style="display: none;"></div>
                    <div class="remove_album_load_item py-2" style="display: none;"><p>Returning this record to the store...</p></div>
                <div id="device_play_loader" class="d-flex flex-column align-items-center">
            </div>
        </div>
    </div>

    </body>

    <!-- Javascript used in this page-->
    <script type="text/javascript" src="{{url_for('static', filename='js/collection/index.js')}}"></script>
{% endblock %}

